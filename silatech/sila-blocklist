const { cmd } = require('../momy');

// Command ya blocklist
cmd({
    pattern: "blocklist",
    alias: ["block", "bl"],
    desc: "Manage blocklist (block/unblock users)",
    category: "owner",
    react: "ğŸš«",
    fromMe: true
},
async(conn, mek, m, { args, reply, addToBlocklist, removeFromBlocklist, getBlocklist }) => {
    const action = args[0]?.toLowerCase();
    const target = args[1];
    const botNumber = conn.user.id.split(':')[0];
    
    if (action === 'add' && target) {
        const userId = target.includes('@') ? target : `${target}@s.whatsapp.net`;
        await addToBlocklist(botNumber, userId);
        
        // Clear cache
        require('../sila.js').blocklistCache.delete(botNumber);
        
        await reply(`âœ… Added ${userId} to blocklist`);
    } else if (action === 'remove' && target) {
        const userId = target.includes('@') ? target : `${target}@s.whatsapp.net`;
        await removeFromBlocklist(botNumber, userId);
        
        // Clear cache
        require('../sila.js').blocklistCache.delete(botNumber);
        
        await reply(`âœ… Removed ${userId} from blocklist`);
    } else if (action === 'list') {
        const blocklist = await getBlocklist(botNumber);
        if (blocklist.length === 0) {
            await reply('ğŸ“‹ Blocklist is empty');
        } else {
            const list = blocklist.map((user, i) => `${i+1}. ${user}`).join('\n');
            await reply(`ğŸš« *BLOCKED USERS:*\n\n${list}`);
        }
    } else {
        await reply(`ğŸ“Œ *Usage:*\n.blocklist add [number]\n.blocklist remove [number]\n.blocklist list`);
    }
});
